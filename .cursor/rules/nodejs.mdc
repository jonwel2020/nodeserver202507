---
alwaysApply: true
---
# ğŸš€ Node.js + Express + MySQL ä¼ä¸šçº§åç«¯APIè„šæ‰‹æ¶æ¡†æ¶å¼€å‘æç¤ºè¯

è¯·å¸®æˆ‘ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ä¼ä¸šçº§ Node.js + Express + MySQL åç«¯APIæœåŠ¡æ¡†æ¶ï¼Œè¿™ä¸ªæ¡†æ¶å°†ä¸ºå°ç¨‹åºç«¯å’Œåå°ç®¡ç†ç«¯æä¾›æ•°æ®æ”¯æŒï¼Œå…¶ä»–é¡¹ç›®åªéœ€åœ¨æ­¤åŸºç¡€ä¸Šå¼€å‘ä¸šåŠ¡åŠŸèƒ½æ¨¡å—å³å¯ã€‚

## ğŸ¯ é¡¹ç›®åŸºæœ¬ä¿¡æ¯
- **é¡¹ç›®åç§°**: express-api-framework
- **æŠ€æœ¯æ ˆ**: Node.js + Express + MySQL + Redis + JWT
- **æ¶æ„æ¨¡å¼**: MVC + ä¸‰å±‚æ¶æ„ (Controller â†’ Service â†’ Repository)
- **ä»£ç é£æ ¼**: ç»Ÿä¸€ä½¿ç”¨ä¸­æ–‡æ³¨é‡Šï¼Œéµå¾ªä¼ä¸šçº§å¼€å‘è§„èŒƒ
- **æ ¸å¿ƒç‰¹è‰²**: åŒç«¯å®Œå…¨éš”ç¦»æ¶æ„ï¼Œæ”¯æŒå°ç¨‹åºç«¯å’Œç®¡ç†ç«¯

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„

```
express-api-framework/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ database.js         # æ•°æ®åº“é…ç½®ï¼ˆæ”¯æŒè¯»å†™åˆ†ç¦»ï¼‰
â”‚   â”‚   â”œâ”€â”€ redis.js            # Redisé…ç½®
â”‚   â”‚   â”œâ”€â”€ logger.js           # æ—¥å¿—é…ç½®
â”‚   â”‚   â””â”€â”€ index.js            # ç»Ÿä¸€é…ç½®å¯¼å‡º
â”‚   â”œâ”€â”€ controllers/            # æ§åˆ¶å™¨å±‚ï¼ˆå¤„ç†HTTPè¯·æ±‚/å“åº”ï¼‰
â”‚   â”‚   â”œâ”€â”€ base/
â”‚   â”‚   â”‚   â””â”€â”€ BaseController.js
â”‚   â”‚   â”œâ”€â”€ api/                # å°ç¨‹åºç«¯æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthController.js
â”‚   â”‚   â”‚   â””â”€â”€ UserController.js
â”‚   â”‚   â””â”€â”€ admin/              # ç®¡ç†ç«¯æ§åˆ¶å™¨
â”‚   â”‚       â”œâ”€â”€ AuthController.js
â”‚   â”‚       â””â”€â”€ UserController.js
â”‚   â”œâ”€â”€ services/               # æœåŠ¡å±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”‚   â”œâ”€â”€ base/
â”‚   â”‚   â”‚   â””â”€â”€ BaseService.js
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â””â”€â”€ AuthService.js
â”‚   â”‚   â””â”€â”€ users/
â”‚   â”‚       â””â”€â”€ UserService.js
â”‚   â”œâ”€â”€ repositories/           # æ•°æ®è®¿é—®å±‚ï¼ˆæ•°æ®åº“æ“ä½œæŠ½è±¡ï¼‰
â”‚   â”‚   â”œâ”€â”€ base/
â”‚   â”‚   â”‚   â””â”€â”€ BaseRepository.js
â”‚   â”‚   â””â”€â”€ users/
â”‚   â”‚       â””â”€â”€ UserRepository.js
â”‚   â”œâ”€â”€ models/                 # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ base/
â”‚   â”‚   â”‚   â””â”€â”€ BaseModel.js
â”‚   â”‚   â”œâ”€â”€ User.js             # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â””â”€â”€ Role.js             # è§’è‰²æ¨¡å‹
â”‚   â”œâ”€â”€ dto/                    # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginDto.js
â”‚   â”‚   â”‚   â””â”€â”€ RegisterDto.js
â”‚   â”‚   â””â”€â”€ users/
â”‚   â”‚       â””â”€â”€ UserDto.js
â”‚   â”œâ”€â”€ validators/             # éªŒè¯å™¨
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â””â”€â”€ user.js
â”‚   â”œâ”€â”€ middleware/             # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.js             # é€šç”¨è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ apiAuth.js          # å°ç¨‹åºç«¯è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ adminAuth.js        # ç®¡ç†ç«¯è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ rateLimiter.js      # é™æµä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ validation.js       # æ•°æ®éªŒè¯ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ errorHandler.js     # é”™è¯¯å¤„ç†ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ logger.js           # æ—¥å¿—ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ cors.js             # è·¨åŸŸä¸­é—´ä»¶
â”‚   â”œâ”€â”€ routes/                 # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ index.js            # ä¸»è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ api/                # å°ç¨‹åºç«¯è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ index.js        # å°ç¨‹åºç«¯è·¯ç”±èšåˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.js         # å°ç¨‹åºç«¯è®¤è¯è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ users.js        # å°ç¨‹åºç«¯ç”¨æˆ·è·¯ç”±
â”‚   â”‚   â””â”€â”€ admin/              # ç®¡ç†ç«¯è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ index.js        # ç®¡ç†ç«¯è·¯ç”±èšåˆ
â”‚   â”‚       â”œâ”€â”€ auth.js         # ç®¡ç†ç«¯è®¤è¯è·¯ç”±
â”‚   â”‚       â””â”€â”€ users.js        # ç®¡ç†ç«¯ç”¨æˆ·è·¯ç”±
â”‚   â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ response.js         # ç»Ÿä¸€å“åº”æ ¼å¼
â”‚   â”‚   â”œâ”€â”€ cache.js            # ç¼“å­˜å·¥å…·
â”‚   â”‚   â”œâ”€â”€ crypto.js           # åŠ å¯†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ upload.js           # æ–‡ä»¶ä¸Šä¼ å·¥å…·
â”‚   â”‚   â”œâ”€â”€ email.js            # é‚®ä»¶å‘é€å·¥å…·
â”‚   â”‚   â””â”€â”€ scheduler.js        # å®šæ—¶ä»»åŠ¡å·¥å…·
â”‚   â”œâ”€â”€ constants/              # å¸¸é‡å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ errors.js           # é”™è¯¯ä»£ç 
â”‚   â”‚   â”œâ”€â”€ roles.js            # è§’è‰²æƒé™å®šä¹‰
â”‚   â”‚   â””â”€â”€ status.js           # çŠ¶æ€ç å®šä¹‰
â”‚   â””â”€â”€ app.js                  # åº”ç”¨å…¥å£
â”œâ”€â”€ tests/                      # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ unit/                   # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ integration/            # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ fixtures/               # æµ‹è¯•æ•°æ®
â”œâ”€â”€ docs/                       # æ–‡æ¡£
â”‚   â”œâ”€â”€ api.md                  # APIæ–‡æ¡£
â”‚   â””â”€â”€ deployment.md           # éƒ¨ç½²æ–‡æ¡£
â”œâ”€â”€ scripts/                    # è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ init-database.sql       # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ test-database.js        # æ•°æ®åº“æµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ seed-data.js            # æµ‹è¯•æ•°æ®è„šæœ¬
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ package.json
â”œâ”€â”€ server.js                   # æœåŠ¡å™¨å…¥å£æ–‡ä»¶
â””â”€â”€ README.md
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. åˆ†å±‚æ¶æ„è®¾è®¡
- **Controller å±‚**ï¼šå¤„ç†HTTPè¯·æ±‚/å“åº”ï¼Œå‚æ•°éªŒè¯ï¼Œè°ƒç”¨Serviceå±‚
- **Service å±‚**ï¼šä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œäº‹åŠ¡ç®¡ç†ï¼Œè°ƒç”¨Repositoryå±‚
- **Repository å±‚**ï¼šæ•°æ®è®¿é—®æŠ½è±¡ï¼Œå°è£…æ•°æ®åº“æ“ä½œï¼Œä¾¿äºæµ‹è¯•å’Œåˆ‡æ¢æ•°æ®æº
- **Model å±‚**ï¼šæ•°æ®æ¨¡å‹å®šä¹‰ï¼Œå…³ç³»æ˜ å°„ï¼Œæ•°æ®éªŒè¯
- **DTO å±‚**ï¼šæ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œæ¥å£è¾“å…¥è¾“å‡ºè§„èŒƒ

### 2. åŸºç¡€ç±»ç»§æ‰¿ä½“ç³»
- **BaseController**ï¼šç»Ÿä¸€å“åº”æ ¼å¼ã€é”™è¯¯å¤„ç†ã€å‚æ•°éªŒè¯ã€åˆ†é¡µé€»è¾‘
- **BaseService**ï¼šé€šç”¨ä¸šåŠ¡é€»è¾‘ã€ç¼“å­˜ç®¡ç†ã€äº‹åŠ¡å¤„ç†
- **BaseRepository**ï¼šé€šç”¨CRUDæ“ä½œã€æŸ¥è¯¢æ„å»ºå™¨ã€è¿æ¥æ± ç®¡ç†
- **BaseModel**ï¼šé€šç”¨å­—æ®µï¼ˆidã€åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´ã€è½¯åˆ é™¤ï¼‰

### 3. Express.jsæœåŠ¡å™¨é…ç½®
- åŸºç¡€ä¸­é—´ä»¶é…ç½®ï¼ˆcors, helmet, morgan, compressionï¼‰
- å¤šç¯å¢ƒé…ç½®æ”¯æŒï¼ˆå¼€å‘ã€ç”Ÿäº§ã€æµ‹è¯•ï¼‰
- ä¼˜é›…å…³é—­æœºåˆ¶å’Œè¿›ç¨‹ç®¡ç†
- å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼ˆ/healthï¼‰
- ç³»ç»ŸæŒ‡æ ‡ç›‘æ§ç«¯ç‚¹ï¼ˆ/metricsï¼‰
- é™æ€æ–‡ä»¶æœåŠ¡å’Œæ–‡ä»¶ä¸Šä¼ 

### 4. MySQLæ•°æ®åº“é›†æˆ
- ä½¿ç”¨mysql2è¿æ¥æ± é…ç½®
- æ”¯æŒè¯»å†™åˆ†ç¦»é…ç½®
- è¿æ¥æ± ç›‘æ§å’Œè‡ªåŠ¨é‡è¿
- å®Œæ•´çš„äº‹åŠ¡æ”¯æŒ
- æ•°æ®åº“è¿ç§»å’Œç§å­æ•°æ®
- è½¯åˆ é™¤å’Œæ—¶é—´æˆ³è‡ªåŠ¨ç®¡ç†
- ç´¢å¼•ä¼˜åŒ–å’ŒæŸ¥è¯¢æ€§èƒ½ç›‘æ§

### 5. åŒç«¯å®Œå…¨éš”ç¦»æ¶æ„ï¼ˆæ ¸å¿ƒç‰¹è‰²ï¼‰

#### 5.1 è·¯ç”±éš”ç¦»
- **å°ç¨‹åºç«¯**ï¼š`/api/*` å‰ç¼€è·¯ç”±
- **ç®¡ç†ç«¯**ï¼š`/admin/*` å‰ç¼€è·¯ç”±
- å®Œå…¨ç‹¬ç«‹çš„è·¯ç”±ä½“ç³»ï¼Œé¿å…æ··æ·†

#### 5.2 è®¤è¯æœºåˆ¶å·®å¼‚
- **å°ç¨‹åºç«¯è®¤è¯**ï¼š
  - 24å°æ—¶Tokenè¿‡æœŸæ—¶é—´
  - åŸºç¡€æƒé™éªŒè¯
  - ç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±çš„æ•°æ®
- **ç®¡ç†ç«¯è®¤è¯**ï¼š
  - 2å°æ—¶Tokenè¿‡æœŸæ—¶é—´
  - ä¸¥æ ¼æƒé™éªŒè¯å’Œæ“ä½œæ—¥å¿—è®°å½•
  - æ”¯æŒIPç™½åå•é™åˆ¶
  - å®Œæ•´çš„CRUDå’Œç»Ÿè®¡æƒé™

#### 5.3 æ§åˆ¶å™¨åˆ†ç¦»
- `src/controllers/api/` - å°ç¨‹åºç«¯æ§åˆ¶å™¨ï¼ˆæ•°æ®æƒé™å—é™ï¼‰
- `src/controllers/admin/` - ç®¡ç†ç«¯æ§åˆ¶å™¨ï¼ˆæ”¯æŒæ‰¹é‡æ“ä½œå’Œç»Ÿè®¡ï¼‰

#### 5.4 ä¸­é—´ä»¶åˆ†ç¦»
- `apiAuth.js` - å°ç¨‹åºç«¯è®¤è¯ä¸­é—´ä»¶
- `adminAuth.js` - ç®¡ç†ç«¯è®¤è¯ä¸­é—´ä»¶ï¼ˆæ”¯æŒIPç™½åå•ã€æ“ä½œæ—¥å¿—ï¼‰

## ğŸ”’ å®‰å…¨ç‰¹æ€§è¦æ±‚

### 1. èº«ä»½è®¤è¯ä¸æˆæƒ
- JWT Tokenè®¤è¯æœºåˆ¶ï¼ˆAccessToken + RefreshTokenï¼‰
- å¤šç«¯ç™»å½•ç®¡ç†ï¼ˆå°ç¨‹åºã€åå°ç®¡ç†ã€ç§»åŠ¨ç«¯ï¼‰
- åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼ˆRBACï¼‰
- å¯†ç åŠ å¯†å­˜å‚¨ï¼ˆbcryptï¼‰
- ç™»å½•å¤±è´¥é”å®šæœºåˆ¶
- åˆ·æ–°Tokenè‡ªåŠ¨ç»­æœŸ

### 2. å®‰å…¨é˜²æŠ¤æªæ–½
- APIé™æµä¿æŠ¤ï¼ˆexpress-rate-limitï¼‰
- è¾“å…¥éªŒè¯å’Œè¿‡æ»¤ï¼ˆJoiï¼‰
- SQLæ³¨å…¥é˜²æŠ¤ï¼ˆå‚æ•°åŒ–æŸ¥è¯¢ï¼‰
- XSSé˜²æŠ¤å’Œè¾“å‡ºç¼–ç 
- CSRFé˜²æŠ¤ï¼ˆåŒé‡æäº¤Cookieï¼‰
- å®‰å…¨å¤´è®¾ç½®ï¼ˆHelmetï¼‰
- æ•æ„Ÿä¿¡æ¯è„±æ•ï¼ˆæ—¥å¿—ã€å“åº”ï¼‰
- æ–‡ä»¶ä¸Šä¼ å®‰å…¨éªŒè¯

### 3. æ•°æ®éªŒè¯ä½“ç³»
- è¯·æ±‚å‚æ•°éªŒè¯ï¼ˆè·¯å¾„ã€æŸ¥è¯¢ã€è¯·æ±‚ä½“ï¼‰
- æ•°æ®æ ¼å¼å’Œç±»å‹æ ¡éªŒ
- ä¸šåŠ¡è§„åˆ™éªŒè¯
- è‡ªå®šä¹‰éªŒè¯å™¨æ”¯æŒ

## ğŸ¨ APIè®¾è®¡è§„èŒƒ

### 1. RESTfulè®¾è®¡åŸåˆ™
- **èµ„æºå‘½å**ï¼šä½¿ç”¨å¤æ•°åè¯ï¼ˆå¦‚ `/users`ã€`/products`ï¼‰
- **HTTPæ–¹æ³•**ï¼š
  - GETï¼šè·å–èµ„æº
  - POSTï¼šåˆ›å»ºèµ„æº
  - PUTï¼šå®Œæ•´æ›´æ–°èµ„æº
  - PATCHï¼šéƒ¨åˆ†æ›´æ–°èµ„æº
  - DELETEï¼šåˆ é™¤èµ„æº

### 2. çŠ¶æ€ç è§„èŒƒ
- **2xxï¼ˆæˆåŠŸï¼‰**
  - 200 OKï¼šæ“ä½œæˆåŠŸ
  - 201 Createdï¼šåˆ›å»ºæˆåŠŸ
  - 204 No Contentï¼šæ“ä½œæˆåŠŸï¼Œæ— è¿”å›å†…å®¹
- **4xxï¼ˆå®¢æˆ·ç«¯é”™è¯¯ï¼‰**
  - 400 Bad Requestï¼šè¯·æ±‚å‚æ•°é”™è¯¯
  - 401 Unauthorizedï¼šæœªæˆæƒï¼ˆæœªç™»å½•ï¼‰
  - 403 Forbiddenï¼šæƒé™ä¸è¶³
  - 404 Not Foundï¼šèµ„æºä¸å­˜åœ¨
  - 409 Conflictï¼šèµ„æºå†²çªï¼ˆå¦‚é‡å¤æ•°æ®ï¼‰
  - 422 Unprocessable Entityï¼šè¯·æ±‚æ ¼å¼æ­£ç¡®ï¼Œä½†è¯­ä¹‰é”™è¯¯
- **5xxï¼ˆæœåŠ¡å™¨é”™è¯¯ï¼‰**
  - 500 Internal Server Errorï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯
  - 503 Service Unavailableï¼šæœåŠ¡ä¸å¯ç”¨
- **6xxï¼ˆè‡ªå®šä¹‰ä¸šåŠ¡çŠ¶æ€ç ï¼‰**
  - 600 Business Errorï¼šä¸šåŠ¡é€»è¾‘é”™è¯¯
  - 601 Validation Errorï¼šæ•°æ®éªŒè¯é”™è¯¯
  - 602 Database Errorï¼šæ•°æ®åº“æ“ä½œé”™è¯¯

### 3. ç»Ÿä¸€å“åº”æ ¼å¼
```javascript
// æˆåŠŸå“åº”
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": { ... },
  "timestamp": "2025-01-21T10:00:00.000Z"
}

// åˆ†é¡µå“åº”
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "items": [ ... ],
    "pagination": {
      "total": 100,
      "total_pages": 10,
      "current_page": 1,
      "page_size": 10,
      "has_previous": false,
      "has_next": true,
      "is_first_page": true,
      "is_last_page": false
    }
  },
  "timestamp": "2025-01-21T10:00:00.000Z"
}

// é”™è¯¯å“åº”
{
  "code": 400,
  "message": "å‚æ•°é”™è¯¯",
  "error": "è¯¦ç»†é”™è¯¯ä¿¡æ¯",
  "timestamp": "2025-01-21T10:00:00.000Z"
}
```

## ğŸ“‹ å¿…é¡»å®ç°çš„APIæ¥å£

### 1. å°ç¨‹åºç«¯è®¤è¯ç³»ç»Ÿ
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/auth/logout` - ç”¨æˆ·ç™»å‡º
- `POST /api/auth/refresh` - åˆ·æ–°Token
- `GET /api/auth/profile` - è·å–ç”¨æˆ·ä¿¡æ¯
- `POST /api/auth/forgot-password` - å¿˜è®°å¯†ç 
- `POST /api/auth/reset-password` - é‡ç½®å¯†ç 

### 2. å°ç¨‹åºç«¯ç”¨æˆ·ç®¡ç†
#### 2.1 åŸºç¡€ä¿¡æ¯ç®¡ç†
- `GET /api/users/profile` - è·å–ä¸ªäººä¿¡æ¯
- `PUT /api/users/profile` - æ›´æ–°ä¸ªäººä¿¡æ¯
- `POST /api/users/upload-avatar` - ä¸Šä¼ å¤´åƒ
- `DELETE /api/users/avatar` - åˆ é™¤å¤´åƒ

#### 2.2 è´¦æˆ·å®‰å…¨
- `PUT /api/users/change-password` - ä¿®æ”¹å¯†ç 
- `POST /api/users/bind-phone` - ç»‘å®šæ‰‹æœºå·
- `POST /api/users/verify-phone` - éªŒè¯æ‰‹æœºå·
- `PUT /api/users/update-phone` - æ›´æ–°æ‰‹æœºå·
- `POST /api/users/bind-wechat` - ç»‘å®šå¾®ä¿¡
- `DELETE /api/users/unbind-wechat` - è§£ç»‘å¾®ä¿¡

#### 2.3 ç”¨æˆ·è®¾ç½®
- `GET /api/users/settings` - è·å–ç”¨æˆ·è®¾ç½®
- `PUT /api/users/settings` - æ›´æ–°ç”¨æˆ·è®¾ç½®
- `PUT /api/users/privacy-settings` - éšç§è®¾ç½®
- `PUT /api/users/notification-settings` - é€šçŸ¥è®¾ç½®

#### 2.4 è´¦æˆ·çŠ¶æ€ç®¡ç†
- `POST /api/users/deactivate` - æ³¨é”€/åœç”¨è´¦æˆ·
- `GET /api/users/login-history` - ç™»å½•å†å²è®°å½•
- `POST /api/users/feedback` - ç”¨æˆ·åé¦ˆ
- `DELETE /api/users/delete-data` - åˆ é™¤ä¸ªäººæ•°æ®ï¼ˆGDPRåˆè§„ï¼‰

### 3. ç®¡ç†ç«¯è®¤è¯ç³»ç»Ÿ
- `POST /admin/auth/login` - ç®¡ç†å‘˜ç™»å½•
- `POST /admin/auth/logout` - ç®¡ç†å‘˜ç™»å‡º
- `POST /admin/auth/refresh` - åˆ·æ–°Token
- `GET /admin/auth/verify` - èº«ä»½éªŒè¯

### 4. ç®¡ç†ç«¯ç”¨æˆ·ç®¡ç†
- `GET /admin/users` - è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆåˆ†é¡µã€æœç´¢ã€æ’åºï¼‰
- `GET /admin/users/:id` - è·å–å•ä¸ªç”¨æˆ·
- `POST /admin/users` - åˆ›å»ºç”¨æˆ·
- `PUT /admin/users/:id` - æ›´æ–°ç”¨æˆ·
- `DELETE /admin/users/:id` - åˆ é™¤ç”¨æˆ·ï¼ˆè½¯åˆ é™¤ï¼‰
- `DELETE /admin/users/batch` - æ‰¹é‡åˆ é™¤ç”¨æˆ·
- `GET /admin/users/stats` - ç”¨æˆ·ç»Ÿè®¡æ•°æ®

### 5. ç³»ç»Ÿç®¡ç†
- `GET /api/health` - å¥åº·æ£€æŸ¥
- `GET /admin/metrics` - ç³»ç»ŸæŒ‡æ ‡ï¼ˆç®¡ç†ç«¯ï¼‰
- `POST /admin/cache/clear` - æ¸…é™¤ç¼“å­˜ï¼ˆç®¡ç†ç«¯ï¼‰

### 6. æƒé™ç®¡ç†
- `GET /admin/roles` - è·å–è§’è‰²åˆ—è¡¨
- `POST /admin/roles` - åˆ›å»ºè§’è‰²
- `PUT /admin/roles/:id` - æ›´æ–°è§’è‰²
- `DELETE /admin/roles/:id` - åˆ é™¤è§’è‰²
- `GET /admin/permissions` - è·å–æƒé™åˆ—è¡¨

## ğŸ“¦ ä¾èµ–åŒ…é…ç½®

### ç”Ÿäº§ä¾èµ–
```json
{
  "express": "^4.18.0",
  "mysql2": "^3.6.0",
  "redis": "^4.6.0",
  "bcryptjs": "^2.4.3",
  "jsonwebtoken": "^9.0.0",
  "joi": "^17.9.0",
  "helmet": "^7.0.0",
  "cors": "^2.8.5",
  "morgan": "^1.10.0",
  "compression": "^1.7.4",
  "express-rate-limit": "^6.8.0",
  "multer": "^1.4.5",
  "nodemailer": "^6.9.0",
  "winston": "^3.10.0",
  "winston-daily-rotate-file": "^4.7.1",
  "dotenv": "^16.3.0"
}
```

### å¼€å‘ä¾èµ–
```json
{
  "nodemon": "^3.0.0",
  "jest": "^29.6.0",
  "supertest": "^6.3.0",
  "eslint": "^8.45.0",
  "prettier": "^3.0.0",
  "@types/node": "^20.4.0"
}
```

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»ºå®Œæ•´çš„`.env.example`æ–‡ä»¶ï¼ŒåŒ…å«ï¼š

```env
# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=development
API_PREFIX=/api

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_NAME=express_api_db
DB_USER=root
DB_PASSWORD=password
DB_CONNECTION_LIMIT=10
DB_READ_HOST=localhost  # è¯»åº“é…ç½®
DB_WRITE_HOST=localhost # å†™åº“é…ç½®

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# JWTé…ç½®ï¼ˆå°ç¨‹åºç«¯ï¼‰
JWT_SECRET=your-super-secret-jwt-key
JWT_EXPIRES_IN=24h
JWT_REFRESH_SECRET=your-refresh-secret
JWT_REFRESH_EXPIRES_IN=7d

# ç®¡ç†ç«¯JWTé…ç½®
ADMIN_JWT_SECRET=your-admin-secret-key
ADMIN_JWT_EXPIRES_IN=2h
ADMIN_ALLOWED_IPS=127.0.0.1,::1

# é‚®ä»¶é…ç½®
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=5242880
ALLOWED_FILE_TYPES=jpg,jpeg,png,gif,pdf,doc,docx

# æ—¥å¿—é…ç½®
LOG_LEVEL=info
LOG_FILE=./logs/app.log
LOG_MAX_SIZE=10m
LOG_MAX_FILES=5

# é™æµé…ç½®
RATE_LIMIT_WINDOW=15
RATE_LIMIT_MAX_REQUESTS=100
```

## ğŸš€ ä»£ç å®ç°è¦æ±‚

### 1. ä»£ç è§„èŒƒ
- **æ³¨é‡Šè§„èŒƒ**ï¼šæ‰€æœ‰æ³¨é‡Šä½¿ç”¨ä¸­æ–‡ï¼Œä½¿ç”¨JSDocæ ¼å¼æ·»åŠ å‡½æ•°å’Œç±»çš„æ–‡æ¡£
- **å‘½åè§„èŒƒ**ï¼šéµå¾ªé©¼å³°å‘½åæ³•å’Œè¯­ä¹‰åŒ–å‘½å
- **æ–‡ä»¶å‘½å**ï¼šä½¿ç”¨camelCaseï¼Œç±»åä½¿ç”¨PascalCase
- **å¸¸é‡å‘½å**ï¼šä½¿ç”¨UPPER_SNAKE_CASE
- **æ•°æ®åº“è¡¨å**ï¼šä½¿ç”¨snake_caseå‘½å

### 2. é”™è¯¯å¤„ç†
- å…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶
- è‡ªå®šä¹‰é”™è¯¯ç±»å‹
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
- ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼

### 3. æ€§èƒ½ä¼˜åŒ–
- æ•°æ®åº“è¿æ¥æ± é…ç½®
- æŸ¥è¯¢ä¼˜åŒ–å’Œç´¢å¼•ä½¿ç”¨
- ç¼“å­˜ç­–ç•¥å®ç°
- å“åº”å‹ç¼©å’Œé™æ€èµ„æºä¼˜åŒ–
- é¿å…N+1æŸ¥è¯¢é—®é¢˜

### 4. å®‰å…¨è€ƒè™‘
- è¾“å…¥æ•°æ®éªŒè¯å’Œè¿‡æ»¤
- SQLæ³¨å…¥é˜²æŠ¤
- XSSé˜²æŠ¤
- æ•æ„Ÿä¿¡æ¯è„±æ•

### 5. æ—¥å¿—è§„èŒƒ
- åˆ†çº§æ—¥å¿—è®°å½•ï¼ˆerror, warn, info, debugï¼‰
- ç»“æ„åŒ–æ—¥å¿—æ ¼å¼
- è¯·æ±‚æ—¥å¿—åŒ…å«è¯·æ±‚IDã€ç”¨æˆ·IDã€IPç­‰
- æ•æ„Ÿä¿¡æ¯è„±æ•å¤„ç†

### 6. æµ‹è¯•è§„èŒƒ
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡80%ä»¥ä¸Š
- é›†æˆæµ‹è¯•è¦†ç›–æ ¸å¿ƒAPI
- æµ‹è¯•æ•°æ®ä½¿ç”¨fixturesç®¡ç†
- æµ‹è¯•ç¯å¢ƒæ•°æ®éš”ç¦»

## ğŸ—ï¸ è·¯ç”±æ¨¡å—åŒ–è®¾è®¡

### æ–°åŠŸèƒ½æ¨¡å—æ·»åŠ ç¤ºä¾‹ï¼ˆä»¥å•†å“ç®¡ç†ä¸ºä¾‹ï¼‰

#### 1. åˆ›å»ºè·¯ç”±æ–‡ä»¶
```javascript
// routes/admin/products.js
const express = require('express');
const router = express.Router();
const { adminAuth } = require('../../middleware/adminAuth');
const { validateProduct } = require('../../validators/product');
const productController = require('../../controllers/admin/ProductController');

// è·å–å•†å“åˆ—è¡¨
router.get('/', adminAuth, productController.getProducts);

// è·å–å•ä¸ªå•†å“
router.get('/:id', adminAuth, productController.getProductById);

// åˆ›å»ºå•†å“
router.post('/', adminAuth, validateProduct, productController.createProduct);

// æ›´æ–°å•†å“
router.put('/:id', adminAuth, validateProduct, productController.updateProduct);

// åˆ é™¤å•†å“
router.delete('/:id', adminAuth, productController.deleteProduct);

module.exports = router;
```

#### 2. åœ¨è·¯ç”±ç´¢å¼•æ–‡ä»¶ä¸­æ³¨å†Œ
```javascript
// routes/admin/index.js
const productRoutes = require('./products');
router.use('/products', productRoutes);
```

## ğŸ“ é¢å¤–è¦æ±‚

### 1. æ–‡ä»¶ç»“æ„
- **æ¯ä¸ªæ–‡ä»¶éƒ½è¦æœ‰å®Œæ•´çš„å®ç°**ï¼Œä¸è¦åªæ˜¯ç©ºæ–‡ä»¶æˆ–æ³¨é‡Š
- **ç¡®ä¿æ‰€æœ‰å¯¼å…¥å¯¼å‡ºå…³ç³»æ­£ç¡®**
- **æä¾›å®Œæ•´å¯è¿è¡Œçš„ä»£ç **

### 2. æ•°æ®åº“è„šæœ¬
- åˆ›å»ºç”¨æˆ·è¡¨çš„SQLè„šæœ¬
- åˆå§‹åŒ–æ•°æ®çš„ç§å­è„šæœ¬
- æ•°æ®åº“è¿æ¥æµ‹è¯•è„šæœ¬

### 3. æµ‹è¯•æ”¯æŒ
- åŸºç¡€çš„æµ‹è¯•æ¡†æ¶é…ç½®
- è‡³å°‘åŒ…å«å‡ ä¸ªç¤ºä¾‹æµ‹è¯•ç”¨ä¾‹
- æµ‹è¯•æ•°æ®åº“é…ç½®

### 4. æ–‡æ¡£
- è¯¦ç»†çš„README.mdæ–‡ä»¶
- APIæ¥å£æ–‡æ¡£
- éƒ¨ç½²è¯´æ˜æ–‡æ¡£

### 5. å¼€å‘è„šæœ¬
åœ¨package.jsonä¸­é…ç½®å®Œæ•´çš„scriptså‘½ä»¤ï¼š
```json
{
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js",
    "test": "jest",
    "test:watch": "jest --watch",
    "lint": "eslint src/",
    "lint:fix": "eslint src/ --fix",
    "format": "prettier --write src/",
    "db:init": "node scripts/init-database.js",
    "db:seed": "node scripts/seed-data.js"
  }
}
```

## âœ¨ é¡¹ç›®ç‰¹è‰²ä¸ä¼˜åŠ¿

### 1. åŒç«¯å®Œå…¨éš”ç¦»æ¶æ„
- **å®Œå…¨éš”ç¦»çš„è®¤è¯æœºåˆ¶**ï¼šå°ç¨‹åºç«¯å’Œç®¡ç†ç«¯ä½¿ç”¨ä¸åŒçš„JWTå¯†é’¥å’Œè¿‡æœŸæ—¶é—´
- **ç‹¬ç«‹çš„è·¯ç”±ä½“ç³»**ï¼š`/api/*` å’Œ `/admin/*` å®Œå…¨åˆ†ç¦»
- **å·®å¼‚åŒ–çš„æƒé™æ§åˆ¶**ï¼šé’ˆå¯¹ä¸åŒç«¯ç‚¹çš„ç‰¹å®šæƒé™ç­–ç•¥
- **å®‰å…¨æ€§å¢å¼º**ï¼šé™ä½è·¨ç«¯æ”»å‡»é£é™©

### 2. ä¼ä¸šçº§æ¶æ„è®¾è®¡
- **åˆ†å±‚æ¶æ„**ï¼šRoutes â†’ Controllers â†’ Services â†’ Repository æ¸…æ™°åˆ†å±‚
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ä»£ç ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **ç»Ÿä¸€å“åº”æ ¼å¼**ï¼šæ ‡å‡†åŒ–çš„APIå“åº”ï¼ŒåŒ…å«å®Œæ•´çš„åˆ†é¡µä¿¡æ¯
- **å®Œå–„çš„çŠ¶æ€ç ä½“ç³»**ï¼šåŒ…å«è‡ªå®šä¹‰ä¸šåŠ¡çŠ¶æ€ç ï¼ˆ6xxï¼‰

### 3. å¼€å‘æ•ˆç‡ä¼˜åŒ–
- **å¿«é€Ÿè„šæ‰‹æ¶**ï¼šä¸€é”®åˆå§‹åŒ–æ•°æ®åº“å’Œæµ‹è¯•æ•°æ®
- **çƒ­é‡è½½å¼€å‘**ï¼šnodemonæ”¯æŒä»£ç å˜æ›´è‡ªåŠ¨é‡å¯
- **ç»Ÿä¸€å·¥å…·ç±»**ï¼šbcryptã€JWTã€å“åº”æ ¼å¼ç­‰å¼€ç®±å³ç”¨
- **è¯¦ç»†çš„å¼€å‘æ–‡æ¡£**ï¼šåŒ…å«å®Œæ•´çš„APIæ·»åŠ ç¤ºä¾‹

### 4. ç”Ÿäº§å°±ç»ªç‰¹æ€§
- **å®‰å…¨é˜²æŠ¤**ï¼šHelmetã€CORSã€é™æµã€å‚æ•°éªŒè¯ç­‰å…¨æ–¹ä½ä¿æŠ¤
- **æ€§èƒ½ä¼˜åŒ–**ï¼šRedisç¼“å­˜ã€è¿æ¥æ± ã€æŸ¥è¯¢ä¼˜åŒ–
- **ç›‘æ§æ—¥å¿—**ï¼šåˆ†çº§æ—¥å¿—ã€é”™è¯¯è¿½è¸ªã€æ€§èƒ½ç›‘æ§
- **æµ‹è¯•æ”¯æŒ**ï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€APIæµ‹è¯•æ¡†æ¶

### 5. å¯æ‰©å±•æ€§
- **æ’ä»¶åŒ–ä¸­é—´ä»¶**ï¼šæ˜“äºæ·»åŠ æ–°çš„ä¸­é—´ä»¶åŠŸèƒ½
- **æ¨¡å—åŒ–è·¯ç”±**ï¼šæ–°åŠŸèƒ½æ¨¡å—å¯å¿«é€Ÿé›†æˆ
- **æ•°æ®åº“ä¼˜åŒ–**ï¼šæ”¯æŒè¯»å†™åˆ†ç¦»ã€è½¯åˆ é™¤ã€ç´¢å¼•ä¼˜åŒ–
- **ç¼“å­˜ç­–ç•¥**ï¼šå¤šçº§ç¼“å­˜ã€åˆ†å¸ƒå¼ç¼“å­˜æ”¯æŒ

## ğŸ¯ æœ€ç»ˆç›®æ ‡

ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ã€å¯ç›´æ¥è¿è¡Œçš„ä¼ä¸šçº§åç«¯APIæœåŠ¡æ¡†æ¶ï¼Œå¼€å‘è€…åªéœ€è¦ï¼š

1. **è¿è¡Œ `npm install`** å®‰è£…ä¾èµ–
2. **é…ç½®ç¯å¢ƒå˜é‡**
3. **è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬**
4. **æ‰§è¡Œ `npm run dev`** å¯åŠ¨æœåŠ¡

æ¡†æ¶åº”è¯¥å…·å¤‡è‰¯å¥½çš„å¯æ‰©å±•æ€§ï¼Œä¾¿äºå¿«é€Ÿæ·»åŠ æ–°çš„ä¸šåŠ¡æ¨¡å—å’ŒAPIæ¥å£ã€‚ç‰¹åˆ«é€‚åˆéœ€è¦å°ç¨‹åºç«¯å’Œç®¡ç†ç«¯åŒé‡æ”¯æŒçš„ä¼ä¸šçº§åº”ç”¨å¼€å‘ã€‚

## ğŸ“‹ åˆå§‹åŒ–å‘½ä»¤

è¯·æŒ‰ç…§ä»¥ä¸Šè¦æ±‚ï¼Œç”Ÿæˆå®Œæ•´çš„é¡¹ç›®æ–‡ä»¶ç»“æ„å’Œä»£ç å®ç°ã€‚**ç¡®ä¿æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰å®Œæ•´çš„å®ç°ä»£ç ï¼Œè€Œä¸æ˜¯ä»…ä»…æä¾›æ¡†æ¶ç»“æ„**ã€‚æ„å»ºä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„ã€å¯æ‰©å±•çš„ã€å®‰å…¨çš„åç«¯æœåŠ¡æ¡†æ¶ï¼Œæ”¯æŒå¿«é€Ÿä¸šåŠ¡å¼€å‘å’Œéƒ¨ç½²ï¼Œå…·å¤‡å®Œæ•´çš„ç›‘æ§ã€æ—¥å¿—ã€æµ‹è¯•å’Œæ–‡æ¡£ä½“ç³»ã€‚